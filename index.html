<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Windows 7 Ultimate - Final</title>
    <style>
        :root {
            --win-glass: rgba(195, 225, 245, 0.9);
            --win-border: #565656;
            --font-main: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            --select-blue: #e8f5fd;
            --select-border: #9dcbfb;
        }

        * { box-sizing: border-box; user-select: none; -webkit-user-drag: none; }

        body {
            margin: 0; padding: 0;
            background-color: black;
            font-family: var(--font-main);
            overflow: hidden;
            height: 100vh; width: 100vw;
        }

        /* --- UTILS --- */
        .icon-16 { width: 16px; height: 16px; display: block; object-fit: contain; }
        .icon-48 { width: 48px; height: 48px; display: block; object-fit: contain; }

        /* --- MAIN FIXED EXPLORER WINDOW --- */
        #explorer-fixed {
            position: absolute; top: 0; left: 0;
            width: 100%; height: calc(100% - 40px); /* Fill screen minus taskbar */
            background: rgba(220, 235, 245, 1);
            display: flex; flex-direction: column;
            z-index: 1;
        }

        /* Title Bar */
        .title-bar {
            height: 30px;
            background: linear-gradient(to bottom, #eef7fc 0%, #bedbf1 100%);
            display: flex; align-items: center; padding: 0 10px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        .title-text { flex-grow: 1; padding-left: 8px; font-size: 12px; color: #333; text-shadow: 0 1px 0 rgba(255,255,255,0.8); }

        /* Navigation Bar */
        .nav-bar {
            height: 38px; display: flex; align-items: center; padding: 0 10px; gap: 10px;
            background: #f0f0f0; border-bottom: 1px solid #d9d9d9;
        }
        .nav-buttons { display: flex; gap: 2px; }
        .circle-btn {
            width: 30px; height: 30px; border-radius: 50%;
            background: #465ad3; border: 2px solid rgba(255,255,255,0.4);
            box-shadow: inset 0 2px 5px rgba(255,255,255,0.5), 0 1px 3px rgba(0,0,0,0.4);
            display: flex; justify-content: center; align-items: center; cursor: pointer;
        }
        .small-circle { width: 24px; height: 24px; background: transparent; border: 1px solid #ccc; box-shadow: none; }
        .arrow-back { width: 0; height: 0; border-top: 6px solid transparent; border-bottom: 6px solid transparent; border-right: 8px solid white; }
        .arrow-fwd { width: 0; height: 0; border-top: 4px solid transparent; border-bottom: 4px solid transparent; border-left: 6px solid #666; }

        .address-bar {
            flex-grow: 1; height: 26px; background: white; border: 1px solid #7d8ea6;
            display: flex; align-items: center; padding: 0 5px;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.1); font-size: 12px;
        }
        .search-bar {
            width: 220px; height: 26px; background: white; border: 1px solid #7d8ea6;
            margin-left: 10px; padding: 0 8px; display: flex; align-items: center;
            font-size: 12px; color: gray; font-style: italic;
        }

        /* Toolbar */
        .toolbar {
            height: 32px; background: #f4f7fc; border-bottom: 1px solid #d9d9d9;
            display: flex; align-items: center; padding: 0 15px; gap: 10px;
            font-size: 12px; color: #1e1e1e;
        }
        .tool-btn { cursor: pointer; padding: 3px 8px; border: 1px solid transparent; }
        .tool-btn:hover { background: #eaf6fd; border-color: #bce1fc; }
        
        /* Special Button for functionality */
        .btn-add { font-weight: bold; color: #0066cc; }
        .btn-empty { color: red; display: none; } /* Hidden by default */

        /* Main Content */
        .main-container { flex-grow: 1; display: flex; background: white; overflow: hidden; }

        /* Sidebar */
        .sidebar {
            width: 230px; background: #fcfcfc; border-right: 1px solid #dae5f0;
            padding-top: 10px; overflow-y: auto;
        }
        .tree-item {
            display: flex; align-items: center; padding: 3px 5px; font-size: 12px;
            cursor: pointer; border: 1px solid transparent; margin-bottom: 1px;
        }
        .tree-item:hover { background: #eff6fc; border-color: #d9ebf9; }
        .tree-item.active { background: #dceefb; border-color: #98c6ec; }
        .indent-1 { padding-left: 15px; }
        .indent-2 { padding-left: 35px; }
        .group-title { font-weight: normal; color: #1e1e1e; }

        /* File Grid */
        .file-view {
            flex-grow: 1; padding: 10px;
            display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            grid-auto-rows: 100px; align-content: start; gap: 5px;
            overflow-y: auto; background: white;
        }

        .file-card {
            display: flex; flex-direction: column; align-items: center;
            padding: 5px; border: 1px solid transparent; border-radius: 3px; cursor: pointer;
            position: relative;
        }
        .file-card:hover { background: #e8f5fd; border-color: #d9ebf9; }
        .file-card.selected { background: #cce8ff; border-color: #99d1ff; }
        .file-label { font-size: 11px; text-align: center; color: #1e1e1e; word-wrap: break-word; line-height: 1.2; margin-top: 4px; }

        /* --- PREVIEW WINDOW --- */
        #preview-window, #add-window, #del-window {
            position: absolute; top: 15%; left: 25%; width: 500px;
            background: rgba(225, 235, 245, 0.95);
            border-radius: 6px; border: 1px solid #777;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; z-index: 2000;
            backdrop-filter: blur(5px);
        }
        #preview-window { height: 400px; }
        
        .hidden { display: none !important; }

        .popup-header {
            height: 30px; display: flex; justify-content: space-between; align-items: center;
            padding: 0 8px; cursor: move;
            background: linear-gradient(to bottom, #fff 0%, #e0e0e0 100%);
            border-bottom: 1px solid #999; border-radius: 6px 6px 0 0;
        }
        .popup-body {
            padding: 15px; background: #f0f0f0; flex-grow: 1;
            font-size: 12px; border-radius: 0 0 6px 6px;
        }
        .popup-content-view {
            width: 100%; height: 100%; background: #222; display: flex; justify-content: center; align-items: center; overflow: hidden;
        }
        
        /* Form Styles */
        .form-group { margin-bottom: 10px; }
        .form-group label { display: block; margin-bottom: 3px; color: #333; }
        .form-group input, .form-group select { width: 100%; padding: 4px; border: 1px solid #ccc; }
        .btn-win { padding: 4px 15px; border: 1px solid #888; background: #ddd; cursor: pointer; }
        .btn-win:hover { background: #fff; }

        /* --- TASKBAR --- */
        #taskbar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 40px;
            background: linear-gradient(to bottom, #1f2f46 0%, #111a26 100%);
            border-top: 1px solid rgba(255,255,255,0.3);
            display: flex; align-items: center; z-index: 9999;
        }
        .start-btn {
            width: 50px; height: 100%; margin-right: 10px;
            display: flex; justify-content: center; align-items: center;
        }
        .orb-img {
            width: 34px; height: 34px; border-radius: 50%;
            background: radial-gradient(circle at 50% 50%, #1f6b9c 0%, #13344d 100%);
            border: 1px solid #666;
            box-shadow: inset 0 0 5px #42b6f5, 0 0 5px rgba(255,255,255,0.2);
            display:flex; justify-content:center; align-items:center;
            color:white; font-weight:bold; font-size:18px; font-style:italic;
        }
        .tray-area { margin-left: auto; display: flex; align-items: center; gap: 12px; padding-right: 15px; color: white; font-size: 12px; }

    </style>
</head>
<body>

    <!-- MAIN EXPLORER -->
    <div id="explorer-fixed">
        <div class="title-bar">
            <img src="https://img.icons8.com/color/48/monitor--v1.png" class="icon-16" style="margin-right:6px">
            <div class="title-text">Computer</div>
        </div>

        <div class="nav-bar">
            <div class="nav-buttons">
                <div class="circle-btn"><div class="arrow-back"></div></div>
                <div class="circle-btn small-circle"><div class="arrow-fwd"></div></div>
            </div>
            <div class="address-bar">
                <img src="https://img.icons8.com/color/48/folder-invoices--v1.png" class="icon-16" style="margin-right:5px">
                <span id="address-path">Libraries > Pictures</span>
            </div>
            <div class="search-bar">Search...</div>
        </div>

        <div class="toolbar">
            <div class="tool-btn btn-add" onclick="openAddModal()">+ New Item</div>
            <div class="tool-btn btn-empty" id="btn-empty" onclick="emptyBin()">Empty Recycle Bin</div>
            <div class="tool-btn">Organize</div>
            <div class="tool-btn">Share with</div>
            <div class="tool-btn">Burn</div>
        </div>

        <div class="main-container">
            <div class="sidebar">
                <div class="tree-item indent-1 group-title">
                    <img src="https://img.icons8.com/color/48/star--v1.png" class="icon-16"> <span style="margin-left:5px">Favorites</span>
                </div>
                <div class="tree-item indent-2" onclick="nav('Desktop')">
                    <img src="https://img.icons8.com/color/48/desktop-mac.png" class="icon-16"> <span style="margin-left:5px">Desktop</span>
                </div>
                <div class="tree-item indent-2" onclick="nav('Downloads')">
                    <img src="https://img.icons8.com/color/48/download--v1.png" class="icon-16"> <span style="margin-left:5px">Downloads</span>
                </div>
                
                <div class="tree-item indent-1 group-title" style="margin-top:10px;">
                    <img src="https://img.icons8.com/color/48/books.png" class="icon-16"> <span style="margin-left:5px">Libraries</span>
                </div>
                <div class="tree-item indent-2 active" id="node-Pictures" onclick="nav('Pictures')">
                    <img src="https://img.icons8.com/color/48/image-file.png" class="icon-16"> <span style="margin-left:5px">Pictures</span>
                </div>
                <div class="tree-item indent-2" id="node-Music" onclick="nav('Music')">
                    <img src="https://img.icons8.com/color/48/musical-notes.png" class="icon-16"> <span style="margin-left:5px">Music</span>
                </div>

                <div class="tree-item indent-1 group-title" style="margin-top:10px;">
                    <img src="https://img.icons8.com/color/48/trash.png" class="icon-16"> <span style="margin-left:5px">System</span>
                </div>
                <div class="tree-item indent-2" id="node-Recycle Bin" onclick="nav('Recycle Bin')">
                    <img src="https://img.icons8.com/color/48/trash.png" class="icon-16"> <span style="margin-left:5px">Recycle Bin</span>
                </div>
            </div>

            <div class="file-view" id="file-grid">
                <!-- JS Renders Files Here -->
            </div>
        </div>

        <div style="height:28px; background:#f5f6f7; border-top:1px solid #ddd; padding:0 10px; display:flex; align-items:center; color:#555; font-size:11px;">
            <span id="status-count">Items: 0</span>
        </div>
    </div>


    <!-- 1. ADD FILE POPUP -->
    <div id="add-window" class="hidden" style="height:auto;">
        <div class="popup-header"><span>Create New File</span><span style="cursor:pointer" onclick="closeAddModal()">×</span></div>
        <div class="popup-body">
            <div class="form-group">
                <label>File Name:</label>
                <input type="text" id="inp-name" value="NewCode.js">
            </div>
            <div class="form-group">
                <label>Type:</label>
                <select id="inp-type">
                    <option value="code">Code / Text</option>
                    <option value="img">Image URL</option>
                </select>
            </div>
            <div class="form-group">
                <label>Content / Source URL:</label>
                <input type="text" id="inp-src" placeholder="Code or http://image.jpg...">
            </div>
            <div style="text-align:right; margin-top:15px;">
                <button class="btn-win" onclick="saveFile()">Create</button>
                <button class="btn-win" onclick="closeAddModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- 2. PREVIEW POPUP -->
    <div id="preview-window" class="hidden">
        <div class="popup-header" id="drag-prev">
            <span id="prev-title">Preview</span>
            <div style="cursor:pointer; font-weight:bold;" onclick="closePreview()">×</div>
        </div>
        <div class="popup-content-view" id="prev-content"></div>
    </div>

    <!-- 3. DELETE CONFIRMATION POPUP -->
    <div id="del-window" class="hidden" style="height:auto; width:400px;">
        <div class="popup-header"><span>Delete File</span></div>
        <div class="popup-body">
            <div style="display:flex; align-items:center; gap:15px; padding-bottom:15px;">
                <img src="https://img.icons8.com/color/48/trash.png">
                <div>Are you sure you want to move <b id="del-name">file</b> to the Recycle Bin?</div>
            </div>
            <div style="text-align:right;">
                <button class="btn-win" onclick="confirmDelete()">Yes</button>
                <button class="btn-win" onclick="closeDelModal()">No</button>
            </div>
        </div>
    </div>

    <!-- TASKBAR -->
    <div id="taskbar">
        <div class="start-btn"><div class="orb-img">W</div></div>
        <div style="flex-grow:1;"></div>
        <div class="tray-area">
            <img src="https://img.icons8.com/ios-filled/50/ffffff/wifi--v1.png" style="width:16px;">
            <div id="clock">12:00</div>
        </div>
    </div>

    <script>
        // --- FILE SYSTEM DATA ---
        let fileSystem = {
            'Pictures': [
                { id: 1, name: 'Mountain.jpg', type: 'img', src: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=500', icon: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=100' },
                { id: 2, name: 'Code_Screenshot.png', type: 'img', src: 'https://images.unsplash.com/photo-1555066931-4365d14bab8c?w=500', icon: 'https://images.unsplash.com/photo-1555066931-4365d14bab8c?w=100' }
            ],
            'Music': [
                { id: 3, name: 'Track01.mp3', type: 'mp3', icon: 'https://img.icons8.com/color/48/audio-file.png' }
            ],
            'Desktop': [
                { id: 4, name: 'ToDo.txt', type: 'code', src: '1. Buy Milk\n2. Code Windows Sim', icon: 'https://img.icons8.com/color/48/txt.png' }
            ],
            'Downloads': [],
            'Recycle Bin': []
        };

        let currentFolder = 'Pictures';
        let deleteTargetId = null;

        // --- NAVIGATION & RENDER ---
        function nav(folder) {
            currentFolder = folder;
            
            // Sidebar UI update
            document.querySelectorAll('.tree-item').forEach(el => el.classList.remove('active'));
            let node = document.getElementById('node-' + folder);
            if(node) node.classList.add('active');

            // Breadcrumb update
            document.getElementById('address-path').innerText = folder === 'Recycle Bin' ? 'Recycle Bin' : `Libraries > ${folder}`;
            
            // Empty Bin Button visibility
            document.getElementById('btn-empty').style.display = (folder === 'Recycle Bin') ? 'block' : 'none';

            render();
        }

        function render() {
            const grid = document.getElementById('file-grid');
            grid.innerHTML = "";
            const files = fileSystem[currentFolder] || [];
            document.getElementById('status-count').innerText = `Items: ${files.length}`;

            if(files.length === 0) {
                grid.innerHTML = `<div style="color:#777; width:200px; padding:20px;">Folder is empty.</div>`;
                return;
            }

            files.forEach(file => {
                const el = document.createElement('div');
                el.className = 'file-card';
                
                // Icon Logic
                let icon = file.icon; 
                // Fallback for custom code files if no icon provided
                if(!icon) icon = (file.type === 'img') ? file.src : 'https://img.icons8.com/color/48/file.png';

                el.innerHTML = `<img src="${icon}" class="icon-48" draggable="false"><div class="file-label">${file.name}</div>`;
                
                // EVENTS
                el.onclick = () => {
                    document.querySelectorAll('.file-card').forEach(c => c.classList.remove('selected'));
                    el.classList.add('selected');
                };
                
                el.ondblclick = () => openPreview(file);

                // Long Press (Delete)
                addLongPress(el, () => promptDelete(file));

                grid.appendChild(el);
            });
        }

        // --- LONG PRESS LOGIC ---
        function addLongPress(el, action) {
            let timer;
            const start = () => timer = setTimeout(action, 800);
            const end = () => clearTimeout(timer);
            
            el.addEventListener('mousedown', start);
            el.addEventListener('touchstart', start);
            el.addEventListener('mouseup', end);
            el.addEventListener('mouseleave', end);
            el.addEventListener('touchend', end);
        }

        // --- ADD FILE LOGIC ---
        function openAddModal() { document.getElementById('add-window').classList.remove('hidden'); }
        function closeAddModal() { document.getElementById('add-window').classList.add('hidden'); }
        
        function saveFile() {
            const name = document.getElementById('inp-name').value;
            const type = document.getElementById('inp-type').value;
            const src = document.getElementById('inp-src').value;

            if(!name) return alert("Name required");

            let icon = 'https://img.icons8.com/color/48/file.png';
            if(type === 'code') icon = 'https://img.icons8.com/color/48/code-file.png';
            if(type === 'img') icon = src;

            const newFile = {
                id: Date.now(),
                name: name,
                type: type,
                src: src,
                icon: icon
            };

            // Add to current folder (if not bin)
            if(currentFolder === 'Recycle Bin') {
                alert("Cannot create files in Recycle Bin. Switched to Desktop.");
                fileSystem['Desktop'].push(newFile);
                nav('Desktop');
            } else {
                fileSystem[currentFolder].push(newFile);
                render();
            }
            closeAddModal();
        }

        // --- DELETE LOGIC ---
        function promptDelete(file) {
            deleteTargetId = file.id;
            document.getElementById('del-name').innerText = file.name;
            document.getElementById('del-window').classList.remove('hidden');
        }

        function confirmDelete() {
            const list = fileSystem[currentFolder];
            const index = list.findIndex(f => f.id === deleteTargetId);
            
            if(index > -1) {
                const file = list[index];
                if(currentFolder !== 'Recycle Bin') {
                    // Move to bin
                    fileSystem['Recycle Bin'].push(file);
                    list.splice(index, 1);
                } else {
                    // Permanent delete
                    list.splice(index, 1);
                }
            }
            closeDelModal();
            render();
        }

        function closeDelModal() {
            document.getElementById('del-window').classList.add('hidden');
            deleteTargetId = null;
        }

        function emptyBin() {
            if(confirm("Permanently delete all items in Recycle Bin?")) {
                fileSystem['Recycle Bin'] = [];
                render();
            }
        }

        // --- PREVIEW LOGIC ---
        function openPreview(file) {
            const win = document.getElementById('preview-window');
            const content = document.getElementById('prev-content');
            document.getElementById('prev-title').innerText = file.name;
            win.classList.remove('hidden');

            if(file.type === 'img') {
                content.innerHTML = `<img src="${file.src}" style="max-width:100%; max-height:100%;">`;
            } else {
                content.innerHTML = `<textarea style="width:100%; height:100%; background:#222; color:#0f0; border:none; padding:10px; font-family:monospace;">${file.src || "// No Content"}</textarea>`;
            }
        }
        function closePreview() { document.getElementById('preview-window').classList.add('hidden'); }

        // --- DRAG WINDOW UTILS ---
        const pWin = document.getElementById('preview-window');
        const pHandle = document.getElementById('drag-prev');
        let isDrag = false, sx, sy, lx, ly;
        
        pHandle.addEventListener('mousedown', (e) => {
            isDrag = true; sx = e.clientX; sy = e.clientY; lx = pWin.offsetLeft; ly = pWin.offsetTop;
        });
        document.addEventListener('mousemove', (e) => {
            if(isDrag) {
                pWin.style.left = (lx + e.clientX - sx) + 'px';
                pWin.style.top = (ly + e.clientY - sy) + 'px';
            }
        });
        document.addEventListener('mouseup', () => isDrag = false);

        // --- CLOCK ---
        setInterval(() => {
            const d = new Date();
            const min = String(d.getMinutes()).padStart(2,'0');
            document.getElementById('clock').innerText = `${d.getHours()}:${min}`;
        }, 1000);

        // --- INIT ---
        nav('Pictures');

    </script>
</body>
</html>
